/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x946ef5 from'./../messagescompressor.js';import _0x18a261 from'./messages/revisionhistorygetrevisionmessage.js';import _0x361154 from'./responses/revisionhistorygetrevisionresponse.js';import _0x188a82 from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x23cb23 from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x239eed from'./messages/revisionhistoryconnectmessage.js';import _0x8372d8 from'./responses/revisionhistoryconnectresponse.js';import _0x3dd5a1 from'./messages/revisionhistoryreconnectmessage.js';import _0x2e144d from'../ckeditorcloudserviceserror.js';import _0x3f3a80,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x502eb1 from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends EmitterMixin(){constructor(_0x26f043){super(),this['_documentId']=_0x26f043,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0xecebfc){return this['_isConnected']?Promise['resolve']():this['_connect'](_0xecebfc,new _0x239eed(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x55cb93,_0x31e2fa){if(this['isConnected'])throw new _0x2e144d('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x55cb93);return this['_connect'](_0x55cb93,new _0x3dd5a1(this['_documentId'],_0x31e2fa));}async['updateRevisions'](_0x52152d,_0x19000f){const _0x1b01d3=_0x188a82['create']({'documentId':this['_documentId'],'requestId':_0x19000f,'revisions':_0x52152d}),_0x426277=await this['_sendRequest'](_0x188a82['TYPE'],_0x1b01d3),{requestId:_0x547d31}=_0x946ef5['decode'](_0x426277,_0x23cb23);return _0x547d31;}async['getRevision'](_0x4c342f){const _0x58b32a=new _0x18a261(this['_documentId'],_0x4c342f),_0x4b247c=await this['_sendRequest'](_0x18a261['TYPE'],_0x58b32a);return _0x946ef5['decode'](_0x4b247c,_0x361154)['toObject']();}async['_connect'](_0x4899b2,_0x416bb2){if(_0x4899b2['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x2e144d('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x4899b2);this['_wsGateway']=_0x4899b2,this['stopListening'](_0x4899b2,'change:state');const _0x9ffcb7=await _0x4899b2['_sendRequest'](0xc,_0x416bb2['constructor']['TYPE'],_0x946ef5['encode'](_0x416bb2)),{channel:_0x57ceff,requestId:_0x10630a,revisions:_0x402bee}=_0x946ef5['decode'](_0x9ffcb7,_0x8372d8)['toObject']();return this['listenTo'](_0x4899b2,'change:state',(_0x2c0482,_0x1cd83e,_0x2b7d8c)=>this['_onWsGatewayStateChange'](_0x2b7d8c),{'priority':_0x3f3a80['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x4899b2,_0x57ceff),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x402bee,'requestId':_0x10630a};}['_connectToChannel'](_0x3d3687,_0x46293e){this['_channel']=_0x3d3687['_getChannel'](RevisionHistoryService['_SERVICE'],_0x46293e),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x188a82['TYPE']),(_0x3db9de,_0x8447c6)=>{const {documentId:_0x1c1897,requestId:_0x5b8fb6,revisions:_0x3dda03}=_0x946ef5['decode'](_0x8447c6,_0x188a82)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x1c1897,'requestId':_0x5b8fb6,'revisionsData':_0x3dda03});});}['_onWsGatewayStateChange'](_0x30205f){_0x30205f===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x3bf278,_0x386c44){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x502eb1('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x3bf278,_0x946ef5['encode'](_0x386c44));}}RevisionHistoryService['_SERVICE']=0xc;export default RevisionHistoryService;