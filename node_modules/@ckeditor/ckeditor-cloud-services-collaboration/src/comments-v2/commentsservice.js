/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x837e97 from'./../messagescompressor.js';import _0x361def from'./messages/addcommentmessage.js';import _0x6e9094 from'./responses/addcommentresponse.js';import _0xf4c521 from'./messages/connectmessage.js';import _0x1127cc from'./responses/connectresponse.js';import _0x5d46ef from'./messages/removecommentmessage.js';import _0x87b15c from'./messages/removecommentthreadmessage.js';import _0x27284f from'./messages/updatecommentmessage.js';import _0x2f277d from'./messages/getcommentthreadmessage.js';import _0xdbfa0b from'./responses/getcommentthreadresponse.js';import _0x1e42ca from'./messages/getdocumentthreadsmessage.js';import _0x24d7db from'./responses/getdocumentthreadsresponse.js';import _0x2349a1,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x8bb2ef from'./../ckeditorcloudserviceserror.js';import _0x4b6487 from'../sessions/sessions.js';import _0x442e44 from'../errors/ServiceNotConnectedError.js';import _0x3ecf48 from'../ckeditorcloudservicesservererror.js';import _0x129186 from'./responses/comment-threads/addcommentthreadresponse.js';import _0x199908 from'./messages/comment-threads/addcommentthreadmessage.js';import _0x1ffd81 from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x304b78 from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x32bb5c from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x421579 from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends EmitterMixin(){constructor(_0x1f0721){super(),this['_documentId']=_0x1f0721,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x279bca){if(this['_isConnected'])return;if(_0x279bca['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x8bb2ef('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x279bca);const _0xeffa9f=new _0xf4c521(this['_documentId']);this['_wsGateway']=_0x279bca,this['stopListening'](_0x279bca,'change:state');const _0x44a184=await _0x279bca['_sendRequest'](0x9,_0xf4c521['TYPE'],_0x837e97['encode'](_0xeffa9f)),{channel:_0x110164,threads:_0x22b98b}=_0x837e97['decode'](_0x44a184,_0x1127cc);return this['listenTo'](_0x279bca,'change:state',(_0x590815,_0x4bccb2,_0x3dadf6)=>this['_onWsGatewayStateChange'](_0x3dadf6),{'priority':_0x2349a1['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x279bca,_0x110164),this['_isConnected']=!0x0,this['fire']('connected'),_0x22b98b;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x287d92,_0x3e194b,_0x244acd,_0x41ed5a){const _0x4bc4fd=new _0x361def(this['_documentId'],_0x287d92,_0x244acd,_0x3e194b,void 0x0,void 0x0,_0x41ed5a),_0x5d8689=await this['_sendRequest'](_0x361def['TYPE'],_0x4bc4fd);return _0x837e97['decode'](_0x5d8689,_0x6e9094);}async['updateComment'](_0x392d56,_0x5388a0,_0x32d0d0,_0x6c5b30){const _0x5d80a3=void 0x0!==_0x6c5b30,_0x43f678=new _0x27284f(this['_documentId'],_0x392d56,_0x5388a0,_0x32d0d0,_0x6c5b30,_0x5d80a3);await this['_sendRequest'](_0x27284f['TYPE'],_0x43f678);}async['removeComment'](_0x4b215d,_0x31abc1){const _0x35795e=new _0x5d46ef(this['_documentId'],_0x4b215d,_0x31abc1);await this['_sendRequest'](_0x5d46ef['TYPE'],_0x35795e);}async['removeCommentThread'](_0x454d1c){const _0x4b01bb=new _0x87b15c(this['_documentId'],_0x454d1c);await this['_sendRequest'](_0x87b15c['TYPE'],_0x4b01bb);}async['addCommentThread'](_0x1dffef){var _0x11dba2;const _0x2f0de6=new _0x199908(this['_documentId'],_0x1dffef['commentThreadId'],null===(_0x11dba2=_0x1dffef['comments'])||void 0x0===_0x11dba2?void 0x0:_0x11dba2['map'](_0x3e54bd=>({..._0x3e54bd,'documentId':this['_documentId'],'commentThreadId':_0x1dffef['commentThreadId']})),_0x1dffef['context'],_0x1dffef['resolvedBy'],_0x1dffef['createdAt'],_0x1dffef['resolvedAt'],_0x1dffef['deletedAt'],_0x1dffef['attributes']),_0x5d808f=await this['_sendRequest'](_0x199908['TYPE'],_0x2f0de6);return _0x837e97['decode'](_0x5d808f,_0x129186);}async['resolveCommentThread'](_0x3566a9){const _0x20d50b=new _0x1ffd81(_0x3566a9,this['_documentId']),_0x19ce6f=await this['_sendRequest'](_0x1ffd81['TYPE'],_0x20d50b);return _0x837e97['decode'](_0x19ce6f,_0x421579);}async['reopenCommentThread'](_0x3a7077){const _0x37d3dd=new _0x304b78(_0x3a7077,this['_documentId']);await this['_sendRequest'](_0x304b78['TYPE'],_0x37d3dd);}async['updateCommentThread'](_0x4a6685){const _0x1abd66=new _0x32bb5c(_0x4a6685['commentThreadId'],this['_documentId'],_0x4a6685['context'],_0x4a6685['attributes'],_0x4a6685['unlinkedAt']);await this['_sendRequest'](_0x32bb5c['TYPE'],_0x1abd66);}async['getCommentThread'](_0x414e9a,_0x4b8ca1=0x1){const _0x214a4e=new _0x2f277d(_0x414e9a,this['_documentId']);try{const _0x5100d8=await this['_sendRequest'](_0x2f277d['TYPE'],_0x214a4e),_0x6d8d1d=_0x837e97['decode'](_0x5100d8,_0xdbfa0b);return{'commentThreadId':_0x6d8d1d['commentThreadId'],'comments':_0x6d8d1d['comments'],'attributes':_0x6d8d1d['attributes'],'context':_0x6d8d1d['context'],'resolvedAt':_0x6d8d1d['resolvedAt'],'resolvedBy':_0x6d8d1d['resolvedBy'],'deletedAt':_0x6d8d1d['deletedAt'],'unlinkedAt':_0x6d8d1d['unlinkedAt']};}catch(_0x4dfcfb){if('CKEditorCloudServicesServerError'===_0x4dfcfb['name']&&'404'===_0x4dfcfb['code']&&_0x4b8ca1<0x5)return await(_0x381e32=0x64*_0x4b8ca1,new Promise(_0xf4e261=>{setTimeout(_0xf4e261,_0x381e32);})),this['getCommentThread'](_0x414e9a,_0x4b8ca1+0x1);if('CKEditorCloudServicesServerError'===_0x4dfcfb['name'])throw _0x4dfcfb;throw _0x3ecf48['fromPublicError'](_0x4dfcfb);}var _0x381e32;}async['getDocumentThreads'](){const _0x202722=new _0x1e42ca(this['_documentId']),_0x2ac605=await this['_sendRequest'](_0x1e42ca['TYPE'],_0x202722),{threads:_0x24aaa3}=_0x837e97['decode'](_0x2ac605,_0x24d7db);return{'threads':_0x24aaa3};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0x442e44('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x4b6487['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x41d072,_0x66ad63){this['_channel']=_0x41d072['_getChannel'](CommentsService['_SERVICE'],_0x66ad63),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x361def['TYPE']),(_0x3916a1,_0x239be8)=>{const _0x1ed0e6=_0x837e97['decode'](_0x239be8,_0x361def);this['fire']('commentAdded',_0x1ed0e6);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x5d46ef['TYPE']),(_0x42ebd3,_0x217689)=>{const _0x1163c1=_0x837e97['decode'](_0x217689,_0x5d46ef);this['fire']('commentRemoved',_0x1163c1);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x27284f['TYPE']),(_0x5d1565,_0x1a4214)=>{const _0x1e2f89=_0x837e97['decode'](_0x1a4214,_0x27284f);this['fire']('commentUpdated',_0x1e2f89);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x87b15c['TYPE']),(_0x38aa9f,_0x54a9b9)=>{const _0x2d6ccb=_0x837e97['decode'](_0x54a9b9,_0x87b15c);this['fire']('commentThreadRemoved',_0x2d6ccb);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x199908['TYPE']),(_0x314d9f,_0x173b4e)=>{const _0x37a7a8=_0x837e97['decode'](_0x173b4e,_0x199908);this['fire']('commentThreadAdded',_0x37a7a8);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x32bb5c['TYPE']),(_0xe077ec,_0x51da0c)=>{const _0xbc9dac=_0x837e97['decode'](_0x51da0c,_0x32bb5c);this['fire']('commentThreadUpdated',_0xbc9dac);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1ffd81['TYPE']),(_0x4dd931,_0xc6bde4)=>{const _0x465c71=_0x837e97['decode'](_0xc6bde4,_0x1ffd81);this['fire']('commentThreadResolved',_0x465c71);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x304b78['TYPE']),(_0x1ef4b7,_0x20eee0)=>{const _0x238633=_0x837e97['decode'](_0x20eee0,_0x304b78);this['fire']('commentThreadReopened',_0x238633);}));}['_onWsGatewayStateChange'](_0x468778){_0x468778===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x245bb7,_0xe99b9b){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x442e44('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x245bb7,_0x837e97['encode'](_0xe99b9b));}}CommentsService['_SERVICE']=0x9;export default CommentsService;